<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Device Tree View -->
    <record id="kra_etims_device_view_tree" model="ir.ui.view">
        <field name="name">kra.etims.device.view.tree</field>
        <field name="model">kra.etims.device</field>
        <field name="arch" type="xml">
            <tree string="e-TIMS Devices">
                <field name="name"/>
                <field name="device_serial"/>
                <field name="tin"/>
                <field name="bhf_id"/>
                <field name="status" widget="badge"
                       decoration-success="status == 'active'"
                       decoration-info="status == 'initialized'"
                       decoration-muted="status == 'inactive'"/>
                <field name="initialization_date"/>
                <field name="company_id" groups="base.group_multi_company"/>
            </tree>
        </field>
    </record>
    
    <!-- Device Form View -->
    <record id="kra_etims_device_view_form" model="ir.ui.view">
        <field name="name">kra.etims.device.view.form</field>
        <field name="model">kra.etims.device</field>
        <field name="arch" type="xml">
            <form string="e-TIMS Device">
                <header>
                    <button name="action_initialize" 
                            string="Initialize Device" 
                            type="object" 
                            class="oe_highlight"
                            invisible="status != 'draft'"/>
                    <button name="action_sync_codes" 
                            string="Sync Codes" 
                            type="object"
                            invisible="status not in ('initialized', 'active')"/>
                    <button name="action_activate" 
                            string="Activate" 
                            type="object"
                            invisible="status != 'initialized'"/>
                    <button name="action_deactivate" 
                            string="Deactivate" 
                            type="object"
                            invisible="status != 'active'"/>
                    <field name="status" widget="statusbar" 
                           statusbar_visible="draft,initialized,active"/>
                </header>
                <sheet>
                    <group>
                        <group string="Device Information">
                            <field name="name"/>
                            <field name="device_serial"/>
                            <field name="company_id" groups="base.group_multi_company"/>
                        </group>
                        <group string="e-TIMS Configuration">
                            <field name="tin"/>
                            <field name="bhf_id"/>
                        </group>
                    </group>
                    <group string="Status Information">
                        <group>
                            <field name="initialization_date"/>
                            <field name="last_sync_date"/>
                        </group>
                        <group>
                            <field name="kra_result_cd"/>
                            <field name="kra_result_dt"/>
                        </group>
                    </group>
                    <group string="Response Details">
                        <field name="kra_result_msg" nolabel="1"/>
                    </group>
                    <group string="Notes">
                        <field name="notes" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- Device Action -->
    <record id="kra_etims_device_action" model="ir.actions.act_window">
        <field name="name">e-TIMS Devices</field>
        <field name="res_model">kra.etims.device</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Add your first e-TIMS device
            </p>
            <p>
                Register and initialize your OSCU device with KRA e-TIMS.
            </p>
        </field>
    </record>
</odoo>
