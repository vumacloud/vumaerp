<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Product Template Form Inherit -->
    <record id="product_template_view_form_etims" model="ir.ui.view">
        <field name="name">product.template.form.etims</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="arch" type="xml">
            <!-- Add eTIMS registration button -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_register_etims" string="Register eTIMS" type="object"
                        class="oe_stat_button" icon="fa-cloud-upload"
                        invisible="etims_registered"
                        groups="l10n_ke_etims.group_etims_user"/>
                <button class="oe_stat_button" type="object" name="action_register_etims"
                        invisible="not etims_registered" icon="fa-check-circle">
                    <div class="o_stat_info">
                        <span class="o_stat_text text-success">eTIMS Registered</span>
                    </div>
                </button>
            </xpath>

            <!-- Add eTIMS page in notebook -->
            <xpath expr="//notebook" position="inside">
                <page string="eTIMS" name="etims" groups="l10n_ke_etims.group_etims_user">
                    <group>
                        <group string="eTIMS Registration">
                            <field name="etims_registered"/>
                            <field name="etims_item_code"/>
                            <field name="etims_registration_date"/>
                        </group>
                        <group string="Classification">
                            <field name="etims_item_class_id"/>
                            <field name="etims_product_type"/>
                            <field name="etims_tax_type"/>
                        </group>
                    </group>
                    <group>
                        <group string="Unit Codes">
                            <field name="etims_pkg_unit_code"/>
                            <field name="etims_qty_unit_code"/>
                        </group>
                        <group string="Additional Info">
                            <field name="etims_origin_country_id"/>
                            <field name="etims_insurance_applicable"/>
                            <field name="etims_batch_applicable"/>
                        </group>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Product Tree Inherit -->
    <record id="product_template_view_tree_etims" model="ir.ui.view">
        <field name="name">product.template.tree.etims</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_tree_view"/>
        <field name="arch" type="xml">
            <xpath expr="//list" position="inside">
                <field name="etims_registered" string="eTIMS" widget="boolean" optional="hide"/>
            </xpath>
        </field>
    </record>

    <!-- eTIMS Item Classification Views -->
    <record id="etims_item_class_view_tree" model="ir.ui.view">
        <field name="name">etims.item.class.tree</field>
        <field name="model">etims.item.class</field>
        <field name="arch" type="xml">
            <list string="Item Classifications">
                <field name="code"/>
                <field name="name"/>
                <field name="tax_type"/>
                <field name="tax_rate"/>
                <field name="active"/>
            </list>
        </field>
    </record>

    <record id="etims_item_class_view_form" model="ir.ui.view">
        <field name="name">etims.item.class.form</field>
        <field name="model">etims.item.class</field>
        <field name="arch" type="xml">
            <form string="Item Classification">
                <sheet>
                    <group>
                        <group>
                            <field name="code"/>
                            <field name="name"/>
                        </group>
                        <group>
                            <field name="tax_type"/>
                            <field name="tax_rate"/>
                            <field name="active"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="etims_item_class_action" model="ir.actions.act_window">
        <field name="name">Item Classifications</field>
        <field name="res_model">etims.item.class</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No item classifications found
            </p>
            <p>
                Item classifications are synced from KRA eTIMS. Use the "Sync Codes"
                button in eTIMS Configuration to fetch them.
            </p>
        </field>
    </record>
</odoo>
